from conductor.client.configuration.configuration import Configuration
from conductor.client.http.models import TaskDef
from conductor.client.orkes_clients import OrkesClients

def greet_task_def(client):
    # api_config = Configuration()
    # clients = OrkesClients(configuration=api_config)
    # metadata_client = clients.get_metadata_client()

    metadata_client = client
    task_def = TaskDef()

    task_def.name = 'greet'
    task_def.owner_email = 'admin@admin.com'
    task_def.description = 'greet task'
    task_def.retry_count = 3
    task_def.retry_logic = "LINEAR_BACKOFF"
    task_def.retry_delay_seconds = 1

    # only allow 3 taasks at a time to be in the IN_PROGRESS status
    task_def.concurrent_exec_limit = 3

    # timeout the task if not polled within 60 seconds of scheduling
    task_def.poll_timeout_seconds = 60

    # timeout the task if the does not complete in 2 minutes
    task_def.timeout_seconds = 120

    # for the long running tasks, timeout if the task does not get updated in COMPLETED or IN_PROGRESS status in
    # 60 seconds after the last update
    task_def.response_timeout_seconds = 60

    # only allow 100 executions in a 10-second window! -- Note, this is complementary to concurrent_exec_limit
    task_def.rate_limit_per_frequency = 100
    task_def.rate_limit_frequency_in_seconds = 10

    metadata_client.register_task_def(task_def=task_def)

    # print(f'registered the task -- see the details {api_config.ui_host}/taskDef/{task_def.name}')

if __name__ == '__main__':
    greet_task_def()